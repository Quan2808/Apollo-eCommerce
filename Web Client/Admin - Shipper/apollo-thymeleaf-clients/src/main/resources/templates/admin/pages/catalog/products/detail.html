<th:block th:fragment="styles">
  <link
    th:href="@{/plugins/custom/datatables/datatables.bundle.css}"
    rel="stylesheet"
    type="text/css"
  />
  <style>
    .image-input-placeholder {
      background-image: url("/media/illustrations/blank-image.svg");
    }

    [data-bs-theme="dark"] .image-input-placeholder {
      background-image: url("/media/illustrations/blank-image-dark.svg");
    }
  </style>
</th:block>

<th:block th:fragment="scripts">
  <script th:src="@{/js/custom/catalog/save-product.js}"></script>
  <script
    th:src="@{/plugins/custom/formrepeater/formrepeater.bundle.js}"
  ></script>
  <script th:src="@{/plugins/custom/datatables/datatables.bundle.js}"></script>
  <script th:src="@{/js/custom/catalog/products.js}"></script>
  <script th:src="@{/js/custom/catalog/variants/save.js}"></script>
</th:block>

<th:block th:fragment="content">
  <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
    <ul
      class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-semibold mb-n2"
      role="tablist"
    >
      <li class="nav-item" role="presentation">
        <a
          class="nav-link text-active-primary pb-4"
          data-bs-toggle="tab"
          href="#kt_ecommerce_add_product_general"
          aria-selected="false"
          role="tab"
          >Update</a
        >
      </li>

      <li class="nav-item" role="presentation">
        <a
          class="nav-link text-active-primary pb-4"
          data-bs-toggle="tab"
          href="#kt_ecommerce_add_option_general"
          aria-selected="false"
          role="tab"
          >Option</a
        >
      </li>

      <li class="nav-item" role="presentation">
        <a
          class="nav-link text-active-primary pb-4 active"
          data-bs-toggle="tab"
          href="#kt_ecommerce_add_product_advanced"
          aria-selected="true"
          role="tab"
          >Variants</a
        >
      </li>
    </ul>

    <div class="tab-content">
      <div
        class="tab-pane fade"
        id="kt_ecommerce_add_product_general"
        role="tabpanel"
      >
        <div class="d-flex flex-column gap-7 gap-lg-10">
          <!--start UPDATE product details-->
          <form
            id="kt_ecommerce_add_product_form"
            class="form d-flex flex-column flex-lg-row"
            method="POST"
            action="#"
            th:object="${product}"
            enctype="multipart/form-data"
          >
            <!-- Sidebar -->
            <div
              class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10"
            >
              <!-- Thumbnail Card -->
              <div class="card card-flush py-4">
                <div class="card-header">
                  <div class="card-title">
                    <h2>Thumbnail</h2>
                  </div>
                </div>
                <div class="card-body text-center pt-0">
                  <div
                    class="image-input image-input-empty image-input-outline image-input-placeholder mb-3"
                    data-kt-image-input="true"
                  >
                    <div
                      class="image-input-wrapper w-150px h-150px"
                      th:style="'background-image: url(' + ${product.mainPicture} + ');'"
                    ></div>
                    <label
                      class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                      data-kt-image-input-action="change"
                      data-bs-toggle="tooltip"
                      title="Change thumbnail"
                    >
                      <i class="ki-duotone ki-pencil fs-7"
                        ><span class="path1"></span><span class="path2"></span
                      ></i>
                      <input
                        th:field="*{mainPicturePatch}"
                        type="file"
                        name="mainPicturePatch"
                        accept=".png, .jpg, .jpeg"
                        required
                      />
                      <input type="hidden" name="thumbnail_remove" />
                    </label>
                    <span
                      class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                      data-kt-image-input-action="cancel"
                      data-bs-toggle="tooltip"
                      title="Cancel thumbnail"
                    >
                      <i class="ki-duotone ki-cross fs-2"
                        ><span class="path1"></span><span class="path2"></span
                      ></i>
                    </span>
                    <span
                      class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                      data-kt-image-input-action="remove"
                      data-bs-toggle="tooltip"
                      title="Remove thumbnail"
                    >
                      <i class="ki-duotone ki-cross fs-2"
                        ><span class="path1"></span><span class="path2"></span
                      ></i>
                    </span>
                  </div>
                  <div class="text-muted fs-7">
                    Set the product thumbnail image. Only *.png, *.jpg, and
                    *.jpeg image files are accepted.
                  </div>
                </div>
              </div>
            </div>

            <!-- Main Content -->
            <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
              <!-- General Card -->
              <div class="card card-flush py-4">
                <div class="card-header">
                  <div class="card-title">
                    <h2>Update Product Details</h2>
                  </div>
                </div>
                <div class="card-body pt-0">
                  <div class="mb-10 fv-row">
                    <label class="required form-label">Name</label>
                    <input
                      type="text"
                      name="title"
                      class="form-control mb-2"
                      placeholder="Product name"
                      th:field="*{title}"
                      th:value="${product.title}"
                      required
                    />
                    <div class="text-muted fs-7">
                      A product name is required and recommended to be unique.
                    </div>
                  </div>
                  <div>
                    <label class="required form-label">Description</label>
                    <textarea
                      id="kt_ecommerce_add_product_description"
                      name="description"
                      class="form-control mb-2"
                      rows="5"
                      th:field="*{description}"
                      required
                    ></textarea>
                    <div class="text-muted fs-7">
                      Set a description to the product for better visibility.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex justify-content-end">
                <a
                  th:href="@{/dashboard/catalog/products}"
                  id="kt_ecommerce_add_product_cancel"
                  class="btn btn-light me-5"
                >
                  Cancel
                </a>
                <button
                  type="submit"
                  id="kt_ecommerce_add_product_submit"
                  class="btn btn-primary"
                >
                  <span class="indicator-label"> Save Changes </span>
                  <span class="indicator-progress">
                    Please wait...
                    <span
                      class="spinner-border spinner-border-sm align-middle ms-2"
                    ></span>
                  </span>
                </button>
              </div>
            </div>
          </form>
          <!--end UPDATE product details-->
          
        </div>
      </div>

      <div
        class="tab-pane fade"
        id="kt_ecommerce_add_option_general"
        role="tabpanel"
      >
        <div class="d-flex flex-column gap-7 gap-lg-10">
          <form
            id="kt_ecommerce_add_option_form"
            class="form d-flex flex-column flex-lg-row"
            method="POST"
            th:action="@{/dashboard/catalog/products/{product_id}/option/create(product_id=${id})}"
            th:object="${optionTableDto}"
            enctype="multipart/form-data"
          >
            <!-- Hidden field for product_id -->
            <input type="hidden" name="productId" th:value="${id}" />
            <!-- Main Content -->
            <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
              <!-- General Card -->
              <div class="card card-flush py-4">
                <div class="card-header">
                  <div class="card-title">
                    <h2>Create Product Options</h2>
                  </div>
                </div>
                <div class="card-body pt-0">
                  <div class="mb-10 fv-row">
                    <label class="required form-label">Product ID:</label>
                    <input
                      type="text"
                      name="productId"
                      class="form-control mb-2"
                      placeholder="Product id"
                      th:value="${id}"
                      readonly
                      required
                    />
                    <div class="text-muted fs-7">A product id is required</div>
                  </div>
                  <div>
                    <label class="required form-label"
                      >Options (comma separated):</label
                    >
                    <input
                      type="text"
                      name="name"
                      class="form-control mb-2"
                      placeholder="Option name"
                      th:value="${name}"
                      required
                    />
                    <div class="text-muted fs-7">
                      Set a option to the product for better visibility.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex justify-content-end">
                <a
                  th:href="@{/dashboard/catalog/products}"
                  id="kt_ecommerce_add_option_cancel"
                  class="btn btn-light me-5"
                >
                  Cancel
                </a>
                <button
                  type="submit"
                  id="kt_ecommerce_add_option_submit"
                  class="btn btn-primary"
                >
                  <span class="indicator-label"> Save Changes </span>
                  <span class="indicator-progress">
                    Please wait...
                    <span
                      class="spinner-border spinner-border-sm align-middle ms-2"
                    ></span>
                  </span>
                </button>
              </div>
            </div>
          </form>
          <!--END CREATE PRODUCT OPTION-->

          <!--Create Option Values-->
          <div class="card card-flush py-4">
            <div class="card-header">
              <div class="card-title">
                <h2>Create Option Values</h2>
              </div>
            </div>
            <div class="card-body pt-0">
              <form
                th:action="@{/dashboard/catalog/products/create-option-value}"
                method="post"
                class="form d-flex flex-column gap-5"
              >
                <input type="hidden" name="productId" th:value="${id}" />

                <div class="mb-3">
                  <label class="required form-label">Product ID:</label>
                  <input
                    type="text"
                    name="productId"
                    class="form-control"
                    placeholder="Product id"
                    th:value="${id}"
                    readonly
                    required
                  />
                </div>

                <div class="mb-3">
                  <label class="required form-label" for="options"
                    >Select Option:</label
                  >
                  <select
                    id="options"
                    name="selectedOptionId"
                    class="form-select"
                    th:value="${selectedOptionId}"
                    required
                  >
                    <option
                      th:each="option : ${options}"
                      th:value="${option.id}"
                      th:text="${option.name}"
                    ></option>
                  </select>
                </div>

                <div class="mb-3">
                  <label class="required form-label" for="values"
                    >Option Values (comma separated):</label
                  >
                  <input
                    type="text"
                    id="values"
                    name="values"
                    class="form-control"
                    required
                  />
                </div>

                <div class="d-flex justify-content-end">
                  <button type="submit" class="btn btn-primary">
                    <span class="indicator-label">Create Option Values</span>
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Options Section -->
          <h2 class="mt-5">Options</h2>
          <div class="card card-flush py-4">
            <div class="card-body">
              <div th:if="${options != null}">
                <ul class="list-group">
                  <li th:each="option : ${options}" class="list-group-item">
                    <span
                      th:value="${option.id}"
                      th:text="${option.name}"
                    ></span>
                    <ul class="list-group mt-2">
                      <li
                        th:each="value : ${option.optionValueDTOList}"
                        class="list-group-item"
                      >
                        <span th:text="${value.value}"></span>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
              <div th:if="${options == null}">
                <p class="text-muted">No options found for this product.</p>
              </div>
            </div>
          </div>

          <!-- Option Value Section -->
          <h2 class="mt-5">Option Value</h2>
          <div class="card card-flush py-4">
            <div class="card-body">
              <div th:if="${optionValues != null}">
                <ul class="list-group">
                  <li
                    th:each="optionv : ${optionValues}"
                    class="list-group-item"
                  >
                    <span
                      th:value="${optionv.id}"
                      th:text="${optionv.value}"
                    ></span>
                  </li>
                </ul>
              </div>
              <div th:if="${optionValues == null}">
                <p class="text-muted">
                  No option value found for this product.
                </p>
              </div>
            </div>
          </div>

          <!--           BEGIN - Raw Variant created by product id & option value list-->
          <div class="container">
            <div class="card card-flush py-4">
              <div class="card-header">
                <div class="card-title">
                  <h2>Create Variant</h2>
                </div>
              </div>
              <div class="card-body pt-0">
                <form
                  th:action="@{'/dashboard/catalog/products/create-variant'}"
                  method="post"
                  class="form d-flex flex-column gap-5"
                >
                  <!-- Product ID (hidden) -->
                  <input type="hidden" th:value="${id}" name="productId" />

                  <!-- Product ID Display -->
                  <div class="mb-3">
                    <label class="required form-label">Product ID:</label>
                    <input
                      type="text"
                      name="productId"
                      class="form-control"
                      th:value="${id}"
                      readonly
                      required
                    />
                  </div>

                  <!-- Option Values -->
                  <div class="mb-3">
                    <label class="required form-label" for="optionValues"
                      >Select Option Values:</label
                    >
                    <select
                      multiple
                      class="form-select"
                      id="optionValues"
                      name="optionValues"
                      required
                    >
                      <option
                        th:each="optionValue : ${optionValues}"
                        th:value="${optionValue.id}"
                        th:text="${optionValue.value}"
                      ></option>
                    </select>
                  </div>

                  <!-- Submit Button -->
                  <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">
                      Create Variant
                    </button>
                  </div>

                  <!-- Error Message -->
                  <div th:if="${errorMessage != null}" class="mt-3">
                    <p class="text-danger" th:text="${errorMessage}"></p>
                  </div>

                  <!-- Success Message -->
                  <div th:if="${successMessage != null}" class="mt-3">
                    <p class="text-success" th:text="${successMessage}"></p>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!--           END - Raw Variant created by product id & option value list-->
        </div>
      </div>

      <div
        class="tab-pane fade show active"
        id="kt_ecommerce_add_product_advanced"
        role="tabpanel"
      >
        <!-- Nội dung của tab Variants -->
        <div class="d-flex flex-column gap-7 gap-lg-10">
          <div class="card card-flush">
            <div class="card-header align-items-center py-5 gap-2 gap-md-5">
              <div class="card-title">
                <div class="d-flex align-items-center position-relative my-1">
                  <i
                    class="ki-duotone ki-magnifier fs-3 position-absolute ms-4"
                  >
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>
                  <input
                    type="text"
                    data-kt-ecommerce-product-filter="search"
                    class="form-control form-control-solid w-250px ps-12"
                    placeholder="Search Variant"
                  />
                </div>
              </div>
              <div
                class="card-toolbar flex-row-fluid justify-content-end gap-5"
              >
                <button
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#kt_modal_add_variant"
                >
                  <i class="ki-duotone ki-plus fs-2"></i>Add Variant
                </button>
              </div>
            </div>

            <div class="card-body pt-0">
              <table
                class="table align-middle table-row-dashed fs-6 gy-5"
                id="kt_ecommerce_products_table"
              >
                <thead>
                  <tr
                    class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0"
                  >
                    <th></th>
                    <th class="min-w-200px">Variant</th>
                    <th class="text-end min-w-100px">SKU</th>
                    <th class="text-end min-w-100px">QTY</th>
                    <th class="text-end min-w-100px">Price</th>
                    <th class="text-end min-w-100px">Weight</th>
                    <th></th>
                    <th class="text-end min-w-70px">Actions</th>
                  </tr>
                </thead>
                <tbody class="fw-semibold text-gray-600">
                  <tr th:each="i : ${variants}">
                    <td></td>
                    <td>
                      <div class="d-flex align-items-center">
                        <a href="#" class="symbol symbol-50px">
                          <span
                            class="symbol-label"
                            th:style="'background-image: url(' + ${i.img} + ');'"
                          ></span>
                        </a>
                        <div class="ms-5">
                          <!--                                                th:href="@{/dashboard/catalog/products/{id}(id=${i.id})}"-->
                          <a
                            class="text-gray-800 text-hover-primary fs-5 fw-bold"
                            data-kt-ecommerce-product-filter="product_name"
                            th:text="${i.name}"
                          ></a>
                        </div>
                      </div>
                    </td>
                    <td class="text-end pe-0">
                      <span class="fw-bold ms-3" th:text="${i.skuCode}"></span>
                    </td>
                    <td class="text-end pe-0">
                      <span class="fw-bold" th:text="${i.stockQuantity}"></span>
                    </td>
                    <td class="text-end pe-0 fw-bold" th:text="${i.price}"></td>
                    <td class="text-end pe-0">
                      <span class="fw-bold" th:text="${i.weight}"></span>
                    </td>
                    <td></td>
                    <td class="text-end">
                      <a
                        href="#"
                        class="btn btn-sm btn-light btn-flex btn-center btn-active-light-primary"
                        data-kt-menu-trigger="click"
                        data-kt-menu-placement="bottom-end"
                      >
                        Actions
                        <i class="ki-duotone ki-down fs-5 ms-1"></i>
                      </a>
                      <div
                        class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                        data-kt-menu="true"
                      >
                        <div class="menu-item px-3">
                          <a
                            th:href="@{/dashboard/catalog/products/update-variant/{variantId}(variantId=${i.id})}"
                            class="menu-link px-3"
                          >
                            Update
                          </a>
                        </div>
                        <div class="menu-item px-3">
                          <a
                            th:href="@{/dashboard/catalog/products/review-variant/{variantId}(variantId=${i.id})}"
                            class="menu-link px-3"
                          >
                            Review
                          </a>
                        </div>
                        <div class="menu-item px-3">
                          <a
                            th:href="@{/dashboard/catalog/products/variant-image-list/{variantId}(variantId=${i.id})}"
                            class="menu-link px-3"
                          >
                            Image List
                          </a>
                        </div>

                        <!--                                            <div class="menu-item px-3">-->
                        <!--                                                <a href="#" class="menu-link px-3" data-kt-ecommerce-product-filter="delete_row">Delete</a>-->
                        <!--                                            </div>-->
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Begin Reviews Section -->
      <div
        class="tab-pane fade show active"
        id="kt_ecommerce_add_product_reviews"
        role="tabpanel"
      ></div>

      <!-- End Reviews Section -->

      <!-- Modal for updating variants -->
      <div
        class="modal fade"
        id="kt_modal_add_variant"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered mw-650px">
          <div class="modal-content">
            <div class="modal-header" id="kt_modal_add_variant_header">
              <!--                    <h2 class="fw-bold">Update Variant</h2>-->

              <div
                class="btn btn-icon btn-sm btn-active-icon-primary"
                data-kt-variants-modal-action="close"
              >
                <i class="ki-duotone ki-cross fs-1"
                  ><span class="path1"></span><span class="path2"></span
                ></i>
              </div>
            </div>

            <div class="modal-body px-5 my-7">
              <form
                id="kt_modal_add_variant_form"
                class="form"
                th:object="${variant}"
                enctype="multipart/form-data"
                method="POST"
              >
                <div
                  class="d-flex flex-column scroll-y px-5 px-lg-10"
                  id="kt_modal_add_variant_scroll"
                  data-kt-scroll="true"
                  data-kt-scroll-activate="true"
                  data-kt-scroll-max-height="auto"
                  data-kt-scroll-dependencies="#kt_modal_add_variant_header"
                  data-kt-scroll-wrappers="#kt_modal_add_variant_scroll"
                  data-kt-scroll-offset="300px"
                >
                  <!-- Thumbnail -->
                  <div class="fv-row mb-7">
                    <label class="d-block fw-semibold fs-6 mb-5"
                      >Thumbnail</label
                    >
                    <div
                      class="image-input image-input-outline image-input-placeholder"
                      data-kt-image-input="true"
                    >
                      <div
                        class="image-input-wrapper w-125px h-125px"
                        style="
                          background-image: url(/media/illustrations/blank-image.svg);
                        "
                      ></div>

                      <label
                        class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                        data-kt-image-input-action="change"
                        data-bs-toggle="tooltip"
                        title="Change thumbnail"
                      >
                        <i class="ki-duotone ki-pencil fs-7"></i>
                        <input
                          th:field="*{imgPatch}"
                          type="file"
                          name="imgPatch"
                          accept=".png, .jpg, .jpeg"
                        />
                        <input type="hidden" name="thumbnail_remove" />
                      </label>

                      <span
                        class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                        data-kt-image-input-action="cancel"
                        data-bs-toggle="tooltip"
                        title="Cancel thumbnail"
                      >
                        <i class="ki-duotone ki-cross fs-2"></i>
                      </span>

                      <span
                        class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                        data-kt-image-input-action="remove"
                        data-bs-toggle="tooltip"
                        title="Remove thumbnail"
                      >
                        <i class="ki-duotone ki-cross fs-2"></i>
                      </span>
                    </div>
                    <div class="form-text">
                      Allowed file types: png, jpg, jpeg.
                    </div>
                  </div>

                  <!-- Hidden Field for Product ID -->
                  <!--                            <input  th:field="*{productId}" th:text="${productId}" readonly name="productId"/>-->

                  <!-- Hidden Field for Variant ID (if needed) -->
                  <input th:field="*{id}" th:text="${id}" readonly name="id" />

                  <!-- id -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2"
                      >Variant ID</label
                    >
                    <input
                      type="text"
                      th:field="*{id}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="ID"
                    />
                  </div>

                  <!-- Name -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2">Name</label>
                    <input
                      type="text"
                      th:field="*{name}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="Name"
                    />
                  </div>

                  <!-- SKU Code -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2">SKU</label>
                    <input
                      type="text"
                      th:field="*{skuCode}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="SKU Number"
                    />
                  </div>

                  <!-- Stock Quantity -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2"
                      >Quantity</label
                    >
                    <input
                      type="number"
                      th:field="*{stockQuantity}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="Quantity"
                    />
                  </div>

                  <!-- Weight -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2">Weight</label>
                    <input
                      type="number"
                      th:field="*{weight}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="Weight (kg)"
                    />
                  </div>

                  <!-- Price -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2">Price</label>
                    <input
                      type="number"
                      th:field="*{price}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="Price"
                    />
                  </div>

                  <!-- Sale Price -->
                  <div class="fv-row mb-7">
                    <label class="required fw-semibold fs-6 mb-2"
                      >Discount Price</label
                    >
                    <input
                      type="number"
                      th:field="*{salePrice}"
                      class="form-control form-control-solid mb-3 mb-lg-0"
                      placeholder="Discount Price"
                    />
                  </div>
                </div>

                <div class="text-center pt-10">
                  <button
                    type="reset"
                    class="btn btn-light me-3"
                    data-kt-variants-modal-action="cancel"
                  >
                    Discard
                  </button>

                  <button
                    type="submit"
                    class="btn btn-primary"
                    data-kt-variants-modal-action="submit"
                  >
                    <span class="indicator-label">Submit</span>
                    <span class="indicator-progress">
                      Please wait...
                      <span
                        class="spinner-border spinner-border-sm align-middle ms-2"
                      ></span>
                    </span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</th:block>
